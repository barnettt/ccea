package com.ccea.persistence;

import static org.junit.Assert.assertNotNull;

import java.util.List;

import org.junit.BeforeClass;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.AbstractTransactionalJUnit4SpringContextTests;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

import com.ccea.persistence.CceaCrudTests.AbstractCcaaTestData;
import com.ccea.persistence.model.ProjectDAO;
import com.ccea.persistence.model.UserDAO;
import com.ccea.persistence.model.UserProjectDAO;
import com.ccea.persistence.model.pojo.Project;
import com.ccea.persistence.model.pojo.User;
import com.ccea.persistence.model.pojo.UserProject;

@ContextConfiguration({ "classpath:/META-INF/ExampleConfigurationTests-context.xml" })
@RunWith(SpringJUnit4ClassRunner.class)
public class UserReportTest extends AbstractTransactionalJUnit4SpringContextTests {
	
	// needed to create the test data
	@Autowired
	ProjectDAO projectDAO;
	@Autowired
	UserDAO userDAO;
	@Autowired
	UserProjectDAO userProjectDAO;

	
	@Autowired
	private ReportServiceImpl reportService;
	
		
	@BeforeClass
	public void setupBefore() {
		CceaCrudTests.AbstractCcaaTestData data = new CceaCrudTests().new AbstractCcaaTestData();
		
		List<Project> ps = data.getProjects();
		for (Project p : ps) {
			projectDAO.create(p);
		}
		
		// create n userProject for all users
		for (User u : data.getUser()) {
			userDAO.create(u);
			for (UserProject newup : data.getUserProjects(u, ps)) {
				userProjectDAO.create(newup);
		}	 
		
		}
		
	}
	
	
	
	@Test
	public void testGetUesrReport() throws Exception {
		assertNotNull(reportService);
		List<User> l = reportService.getAllUserProjects();
		assertNotNull(l);
		logger.info(l.toString());
				
	}

}
